/*

  this is an example of the data if you are using it locally, just ghost out the getData function above.
  tempData = {
    "data": [
      {
        "id": "6669bcb7-a09c-4f99-a5c3-a0fafa7852ba",
        "title": "Outer Orbit",
        "body": "\u003Cp\u003EPROOF OF CONCEPT\u003C/p\u003E\u003Cp\u003EOrbitLabs, a blockchain-based company, launched OuterOrbit as a proof of concept marketplace that has unique collections, fast using less gas. The platform offers users a chance to buy and sell products with the use of tokens.\u003C/p\u003E\u003Cp\u003EOuterorbit is a blockchain-powered marketplace for unique collections of products. It’s powered by Tomochain, which is a high-performance public blockchain that can handle over 2,000 transactions per second.\u003C/p\u003E\u003Cp\u003EThe company believes that it can offer an alternative to OpenSea by providing a decentralized marketplace where buyers can purchase goods without any middleman fees.\\n\\nThis project is in active development and becomes more robust and feature rich with every update.\u003C/p\u003E",
        "userId": "rspv5d1csvryop3",
        "createdOn": 1722753070794,
        "updatedOn": 1742293068691,
        "image": "/tus/images/r_posts/f_image/f59120ef-488e-4506-802a-638a97e00834.png",
        "images": null,
        "tags": "[\"work\"]",
        "total": 5
      },
      {
        "id": "d1ad56e2-68fb-42e5-88b0-c379cb80f83f",
        "title": "Ultimate Kricket Challenge",
        "body": "\u003Cp\u003EThe Ultimate Kricket Challenge, or UKC, is an action-packed thrilling competition like never before. It is a tournament for the worlds elite cricket players from all over the world. \\n\\nThe UKC will be the world’s first international cricket tournament that is powered by blockchain technology.\u003C/p\u003E\u003Cp\u003EThe UKC aims to provide a new level of transparency and accountability in the sport of cricket by using blockchain technology to record all the data related to this tournament.&nbsp;\u003C/p\u003E\u003Cp\u003EThe ambition of UKC to create the digital currency for cricket was a task that we took on with aplomb. We had been working with them for some time and were aware of the challenges they faced in creating this currency.\u003C/p\u003E\u003Cp\u003EIt was clear that there was a need to rethink how players and fans interacted with cricket, and the idea for ukc was born. Orbitlabs has been working on this project since its inception and has helped UKC in every step of the process from design to development.\u003C/p\u003E",
        "userId": "rspv5d1csvryop3",
        "createdOn": 1722753236554,
        "updatedOn": 1722753236554,
        "image": "/tus/images/r_posts/f_image/4644d4eb-53de-4eb2-9e24-6e3fd62593f8.png",
        "images": null,
        "tags": "[\"work\"]",
        "total": 5
      },
      {
        "id": "d40c8f88-8d79-442b-974c-8521b60a7926",
        "title": "CLASIQ",
        "body": "\u003Cp\u003EBLOCKCHAIN INTEGRATION\u003C/p\u003E\u003Cp\u003EThe world's most trusted auction for classic car enthusiasts.\u003C/p\u003E\u003Cp\u003EThe clasiq.com platform is a marketplace for the classic car industry. It allows people to trade and buy cars with cryptocurrencies, as well as to store them in a secure, decentralized environment.\u003C/p\u003E\u003Cp\u003EClasiq approached &nbsp;Orbitlabs with a request to add blockchain to their website.&nbsp;\u003C/p\u003E\u003Cp\u003EThe idea is that Clasiq wanted to use blockchain technology as a way of providing provenance and ownership for each car.\u003C/p\u003E\u003Cp\u003EWe extended the clasiq platform to allow to use of crypto to create an initial immutable point of reference for every asset that passes through the Clasiq platform as well as the history of the changes. &nbsp;Using counterparty we can offer ownership of this vehicle to the legitimate owner of this vehicle allowing us and them (and 3rd parties) to augment the data with more data as time goes on.\\n\\nit uses a cascading address architecture to track ownership over time and as it passes from users so you can see a full history of the car at any time\u003C/p\u003E\u003Cp\u003EThe solution was built on the BSC blockchain, which has been designed specifically for smart contracts and other applications requiring high levels of security. We use BSC to store digital representations of physical cars that pass through the Clasiq platform.&nbsp;\u003C/p\u003E\u003Cp\u003EThe blockchain provides provenance and ownership for each car. This means that there is an indisputable record of who owns the car and where it came from. The information stored in the blockchain cannot be tampered with or changed without being detected by other users in the network.\\n\\nTake it for a spin now, visit clasiq.com today\u003C/p\u003E",
        "userId": "rspv5d1csvryop3",
        "createdOn": 1722753326470,
        "updatedOn": 1722753326470,
        "image": "/tus/images/r_posts/f_image/881df16a-3346-48f4-81df-2a3ef6e8832a.jpg",
        "images": null,
        "tags": null,
        "total": 5
      },
      {
        "id": "e16e9e02-b9fa-47dc-9fa9-ddd0eda959d5",
        "title": "PLANETOMO",
        "body": "\u003Cp\u003EThe click to earn game on tomochain\u003C/p\u003E\u003Cp\u003EIntroducing Planetomo: Our Experiment in Creating a Play to Win in Crypto\\n\\nPlanetomo, our experiment in creating a play to win in the crypto space. The crypto market is hot, but it’s still early days and there are yet to be many clear winners and leaders in the space. Still, we see huge potential and we think that our data-driven approach will give us an edge in finding the best opportunities possible. We’re excited to share more with you as we continue to learn more about the space and grow Planetomo into something meaningful and valuable to our users, partners and investors.\\n\\n We built this like we build all our tech to make it reusable. &nbsp;The presentation layer which is essentially the game is separated from the game logic so with the game engine we can build just about any game you can imagine on top of it. &nbsp;In fact, if you have an idea for a game that would work well on Planetomo and would like to help us build it please reach out. We’re not looking for clones but unique games that are fun and entertaining.\u003C/p\u003E",
        "userId": "rspv5d1csvryop3",
        "createdOn": 1722753410871,
        "updatedOn": 1722753410871,
        "image": "/tus/images/r_posts/f_image/d8f91254-ba43-4320-b65b-e43b947ca7e2.png",
        "images": null,
        "tags": null,
        "total": 5
      },
      {
        "id": "3b4cc0b7-b7dd-4f14-88dc-f7b62ecf3c7a",
        "title": "BUILDING BLOCK",
        "body": "\u003Cp\u003EHere at Orbitlabs, we think crypto will play a huge part in property ownership and management in the future. However, we felt everyone up to this point have either tried to make it too complex (code is not law) or attached their own token with a monetary slant (making their project a scam) so we thought we would have a go at building a management framework with the following assumptions. \\n\\nIn the context of property ownership, cryptocurrencies could potentially be used to facilitate the buying and selling of real estate. For example, they could be used as a form of payment for the purchase of a property, or as a means of transferring ownership from one person to another. Because cryptocurrencies are decentralized and secure, they could provide an alternative to traditional forms of payment, such as bank transfers or checks, and could make it easier to complete real estate transactions quickly and securely. However, it is important to note that the use of cryptocurrencies in property ownership is still a relatively new and emerging area, and their use in this context is not yet widespread.\\n\\nGive it a spin and log in as an owner with the following credentials\\n\\nusername: test@test.com\\npassword: test\\n\\nIf you would like to host it yourself download the code by clicking the \\\"view code\\\" button&nbsp;\u003C/p\u003E",
        "userId": "rspv5d1csvryop3",
        "createdOn": 1722753472925,
        "updatedOn": 1722753472925,
        "image": "/tus/images/r_posts/f_image/ed2e2b3e-aaf8-4f11-bde4-2dcd5d824d1b.jpg",
        "images": null,
        "tags": null,
        "total": 5
      }
    ],
    "source": "cache",
    "total": 5,
    "executionTime": 0
  }
*/

const superagent = require("superagent");

const getData = async (env, theUrl) => {
  const res = await superagent.get(theUrl).query({});
  return res.body;
};

/**
 * Fetches data from a remote source, categorizes it based on tags,
 * and returns an object containing categorized data.
 *
 * This function makes an asynchronous call to fetch data, which is
 * then processed to separate items into categories based on their tags.
 * Items tagged as "work" are added to the `workData` array, and items
 * tagged as "services" are added to the `servicesData` array. The
 * categorized data is then stored in the `apiData` object, which is
 * returned by the function.
 *
 * @returns {Promise<Object>} A promise that resolves to an object with
 *                            categorized `apiData` containing `work`
 *                            and `services` arrays.
 */

module.exports = async (env) => {
  let apiData = [];
  let tempData;
  let workData = [];
  let servicesData = [];

  //get the work
  tempData = await getData(env, `${env.CMSURL}\work`);
  tempData.data.forEach((item) => {
    //add to the array
    workData.push(item);
  });
  //get the services
  tempData = await getData(env, `${env.CMSURL}\services`);
  tempData.data.forEach((item) => {
    //add to the array
    servicesData.push(item);
  });

  // Assign categorized data to apiData
  apiData.work = workData;
  apiData.services = servicesData;
  //debug
  //console.log(apiData);

  // api data to return
  return {
    apiData,
  };
};
